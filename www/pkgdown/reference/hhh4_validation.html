<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Predictive Model Assessment for hhh4 Models — hhh4_validation • surveillance</title>
<script src="../deps/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="../deps/bs3compat-0.2.4/tabs.js"></script><script src="../deps/bs3compat-0.2.4/bs3compat.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css">
<script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<link href="../syntax-highlighting.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Predictive Model Assessment for hhh4 Models — hhh4_validation">
<meta property="og:description" content="The function oneStepAhead computes successive one-step-ahead
  predictions for a (random effects) HHH model fitted by hhh4.
  These can be inspected using the quantile, confint or
  plot methods.
  The associated scores-method computes a number of (strictly) proper
  scoring rules based on such one-step-ahead predictions;
  see Paul and Held (2011) for details.
  There are also calibrationTest and pit
  methods for oneStepAhead predictions.  
Scores, calibration tests and PIT histograms can also be
  computed for the fitted values of an hhh4 model
  (i.e., in-sample/training data evaluation).">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@bastistician">
<meta name="twitter:site" content="@bastistician">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc" data-headroom data-tolerance="5" data-offset="100">
    

      <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a class="navbar-brand mb-0 h1" href="../index.html">surveillance</a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <button type="button" id="version-badge" class="badge badge-default d-none d-lg-block" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Released version">1.19.1</button>

    <div id="navbar" class="collapse navbar-collapse">
      <ul class="navbar-nav mr-auto ml-3">
<li class="nav-item">
  <a class="nav-link" href="../articles/pkgdown/overview.html">Overview</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/pkgdown/events.html">Events</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/pkgdown/bibliography.html">Bibliography</a>
</li>
      </ul>
<ul class="navbar-nav ml-1"></ul>
</div>
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header pb-2 mt-4 mb-2 border-bottom toc-ignore">
    <h1 class="display-4">Predictive Model Assessment for <code>hhh4</code> Models</h1>
    
    <div class="d-none name"><code>hhh4_validation.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function <code>oneStepAhead</code> computes successive one-step-ahead
  predictions for a (random effects) HHH model fitted by <code><a href="hhh4.html">hhh4</a></code>.
  These can be inspected using the <code>quantile</code>, <code>confint</code> or
  <code>plot</code> methods.
  The associated <code><a href="scores.html">scores</a></code>-method computes a number of (strictly) proper
  scoring rules based on such one-step-ahead predictions;
  see Paul and Held (2011) for details.
  There are also <code><a href="calibrationTest.html">calibrationTest</a></code> and <code><a href="pit.html">pit</a></code>
  methods for <code>oneStepAhead</code> predictions.</p>  
<p>Scores, calibration tests and PIT histograms can also be
  computed for the fitted values of an <code>hhh4</code> model
  (i.e., in-sample/training data evaluation).</p>
    </div>

    <pre class="usage"><code class="sourceCode R"><span class="fu">oneStepAhead</span><span class="op">(</span><span class="va">result</span>, <span class="va">tp</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rolling"</span>, <span class="st">"first"</span>, <span class="st">"final"</span><span class="op">)</span>,
             which.start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"current"</span>, <span class="st">"final"</span><span class="op">)</span>,
             keep.estimates <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co"># S3 method for oneStepAhead</span>
<span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">90</span>, <span class="fl">97.5</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="va">...</span><span class="op">)</span>
<span class="co"># S3 method for oneStepAhead</span>
<span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">parm</span>, level <span class="op">=</span> <span class="fl">0.95</span>, <span class="va">...</span><span class="op">)</span>
<span class="co"># S3 method for oneStepAhead</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>, unit <span class="op">=</span> <span class="fl">1</span>, probs <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">99</span><span class="op">/</span><span class="fl">100</span>,
     start <span class="op">=</span> <span class="cn">NULL</span>, means.args <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span>

<span class="co">## assessment of "oneStepAhead" predictions</span>
<span class="co"># S3 method for oneStepAhead</span>
<span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span><span class="va">x</span>, which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"logs"</span>, <span class="st">"rps"</span>, <span class="st">"dss"</span>, <span class="st">"ses"</span><span class="op">)</span>,
       units <span class="op">=</span> <span class="cn">NULL</span>, sign <span class="op">=</span> <span class="cn">FALSE</span>, individual <span class="op">=</span> <span class="cn">FALSE</span>, reverse <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span>
<span class="co"># S3 method for oneStepAhead</span>
<span class="fu"><a href="calibrationTest.html">calibrationTest</a></span><span class="op">(</span><span class="va">x</span>, units <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span>
<span class="co"># S3 method for oneStepAhead</span>
<span class="fu"><a href="pit.html">pit</a></span><span class="op">(</span><span class="va">x</span>, units <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span>

<span class="co">## assessment of the "hhh4" model fit (in-sample predictions)</span>
<span class="co"># S3 method for hhh4</span>
<span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span><span class="va">x</span>, which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"logs"</span>, <span class="st">"rps"</span>, <span class="st">"dss"</span>, <span class="st">"ses"</span><span class="op">)</span>,
       subset <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">control</span><span class="op">$</span><span class="va">subset</span>, units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">nUnit</span><span class="op">)</span>, sign <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span>
<span class="co"># S3 method for hhh4</span>
<span class="fu"><a href="calibrationTest.html">calibrationTest</a></span><span class="op">(</span><span class="va">x</span>,
                subset <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">control</span><span class="op">$</span><span class="va">subset</span>, units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">nUnit</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span>
<span class="co"># S3 method for hhh4</span>
<span class="fu"><a href="pit.html">pit</a></span><span class="op">(</span><span class="va">x</span>, subset <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">control</span><span class="op">$</span><span class="va">subset</span>, units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">nUnit</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></code></pre>

    <h2>Arguments</h2>
    <dl class="row" id="ref-arguments">
<dt class="col-sm-3" id="ref-arguments name">result</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>fitted <code><a href="hhh4.html">hhh4</a></code> model (class <code>"hhh4"</code>).</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">tp</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>numeric vector of length 2 specifying the time range in
    which to compute one-step-ahead predictions (for the time points
    <code>tp[1]+1</code>, ..., <code>tp[2]+1</code>).
    If a single time index is specified, it is interpreted as
    <code>tp[1]</code>, and <code>tp[2]</code> is set to the penultimate time point
    of <code>result$control$subset</code>.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">type</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>The default <code>"rolling"</code> procedure sequentially 
    refits the model up to each time point in <code>tp</code> and computes
    the one-step-ahead predictions for the respective next time point.
    The alternative <code>type</code>s are no true one-step-ahead predictions
    but much faster:
    <code>"first"</code> will refit the model for the first time point
    <code>tp[1]</code> only and use this specific fit to calculate all
    subsequent predictions, whereas
    <code>"final"</code> will just use <code>result</code> to calculate these.
    The latter case thus gives nothing else than a subset of
    <code>result$fitted.values</code> if the <code>tp</code>'s are part of the
    fitted subset <code>result$control$subset</code>.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">which.start</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>Which initial parameter values should be used when successively
    refitting the model to subsets of the data (up to time point
    <code>tp[1]</code>, up to <code>tp[1]+1</code>, ...) if <code>type="rolling"</code>?
    Default (<code>"current"</code>) is to use the parameter estimates from the
    previous time point, and <code>"final"</code> means to always
    use the estimates from <code>result</code> as initial values.
    Alternatively, <code>which.start</code> can be a list of <code>start</code>
    values as expected by <code><a href="hhh4.html">hhh4</a></code>, which then replace
    the corresponding estimates from <code>result</code> as initial values.
    This argument is ignored for “non-rolling” <code>type</code>s.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">keep.estimates</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>logical indicating if parameter estimates and log-likelihoods from
    the successive fits should be returned.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">verbose</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>non-negative integer (usually in the range <code>0:3</code>) specifying
    the amount of tracing information to output.
    During <code>hhh4</code> model updates, the following verbosity is used:
    <code>0</code> if <code>cores &gt; 1</code>, otherwise <code>verbose-1</code> if there
    is more than one time point to predict, otherwise <code>verbose</code>.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">cores</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>the number of cores to use when computing
    the predictions for the set of time points <code>tp</code> in parallel
    (with <code><a href="https://rdrr.io/r/parallel/mclapply.html">mclapply</a></code>).
    Note that parallelization is not possible in the default setting
    <code>type="rolling"</code> and <code>which.start="current"</code> (use
    <code>which.start="final"</code> for this to work).</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">object</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>an object of class <code>"oneStepAhead"</code>.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">parm</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>unused (argument of the generic).</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">level</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>required confidence level of the prediction interval.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">probs</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>numeric vector of probabilities with values in [0,1].</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">unit</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>single integer or character selecting a unit for which to
    produce the plot.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">start</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>x-coordinate of the first prediction. If <code>start=NULL</code>
    (default), this is derived from <code>x</code>.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">means.args</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>if a list (of graphical parameters for <code><a href="https://rdrr.io/r/graphics/lines.html">lines</a></code>),
    the point predictions (from <code>x$pred</code>) are added to the plot.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">x</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>an object of class <code>"oneStepAhead"</code> or <code>"hhh4"</code>.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">which</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>character vector determining which scores to compute.
    The package <span class="pkg">surveillance</span> implements the following proper
    scoring rules: logarithmic score (<code>"logs"</code>), ranked probability
    score (<code>"rps"</code>), Dawid-Sebastiani score (<code>"dss"</code>), and
    squared error score (<code>"ses"</code>). The normalized SES
    (<code>"nses"</code>) is also available but it is improper and hence not
    computed by default.<br>
    It is possible to name own scoring rules in <code>which</code>. These
    must be functions of <code>(x, mu, size)</code>, vectorized in all arguments
    (time x unit matrices) except that <code>size</code> is <code>NULL</code>
    in case of a Poisson model.
    See the available scoring rules for guidance, e.g., <code><a href="scores.html">dss</a></code>.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">subset</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>subset of time points for which to calculate the scores
    (or test calibration, or produce the PIT histogram, respectively).
    Defaults to the subset used for fitting the model.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">units</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>integer or character vector indexing the units for which
    to compute the scores (or the calibration test or the PIT histogram,
    respectively). By default, all units are considered.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">sign</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>logical indicating if the function should also return
    <code><a href="https://rdrr.io/r/base/sign.html">sign(x-mu)</a></code>, i.e., the sign of the difference between
    the observed counts and corresponding predictions.
    This does not really make sense when averaging over multiple
    <code>units</code> with <code>individual=FALSE</code>.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">individual</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>logical indicating if the individual scores of the
    <code>units</code> should be returned. By default (<code>FALSE</code>), the
    individual scores are averaged over all <code>units</code>.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">reverse</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>logical indicating if the rows (time points) should be
    reversed in the result. The long-standing but awkward default was to
    do so for the <code>oneStepAhead</code>-method. This has changed in
    version 1.16.0, so time points are no longer reversed by default.</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">...</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>Unused by the <code>quantile</code>, <code>confint</code> and
    <code>scores</code> methods.<br>
    The <code>plot</code>-method passes further arguments to the
    <code><a href="fanplot.html">fanplot</a></code> function, e.g., <code>fan.args</code>,
    <code>observed.args</code>, and <code>key.args</code> can be used to modify the
    plotting style.<br>
    For the <code>calibrationTest</code>-method, further arguments are passed
    to <code><a href="calibrationTest.html">calibrationTest.default</a></code>, e.g., <code>which</code> to
    select a scoring rule.<br>
    For the <code>pit</code>-methods, further arguments are passed to
    <code><a href="pit.html">pit.default</a></code>.</p></dd>
    </dl>
<h2 class="hasAnchor" id="value">
<a class="anchor" href="#value"></a>Value</h2>

    <p><code>oneStepAhead</code> returns a list (of class <code>"oneStepAhead"</code>)
with the following components:</p>
<dt>pred</dt>
<dd><p>one-step-ahead predictions in a matrix, where each row
  corresponds to one of the time points requested via the argument
  <code>tp</code>, and which has <code><a href="https://rdrr.io/r/base/nrow.html">ncol(result$stsObj)</a></code>
  unit-specific columns. The rownames indicate the predicted time points
  and the column names are identical to <code><a href="https://rdrr.io/r/base/colnames.html">colnames(result$stsObj)</a></code>.</p></dd>
<dt>observed</dt>
<dd><p>matrix with observed counts at the predicted time
  points. It has the same dimensions and names as <code>pred</code>.</p></dd>
<dt>psi</dt>
<dd><p>in case of a negative-binomial model, a matrix of the
  estimated overdispersion parameter(s) at each time point on 
  the internal -log-scale (1 column if <code>"NegBin1"</code>,
  <code><a href="https://rdrr.io/r/base/nrow.html">ncol(observed)</a></code> columns if <code>"NegBinM"</code> or shared overdispersion). 
  For a <code>"Poisson"</code> model, this component is <code>NULL</code>.</p></dd>
<dt>allConverged</dt>
<dd><p>logical indicating if all successive fits
  converged.</p></dd>

If keep.estimates=TRUE, there are the following additional elements:
<dt>coefficients</dt>
<dd><p>matrix of estimated regression parameters from the successive fits.</p></dd>
<dt>Sigma.orig</dt>
<dd><p>matrix of estimated variance parameters from the successive fits.</p></dd>
<dt>logliks</dt>
<dd><p>matrix with columns <code>"loglikelihood"</code> and
  <code>"margll"</code> with their obvious meanings.</p></dd>

The quantile-method computes quantiles of the one-step-ahead
forecasts. If there is only one unit, it returns a tp x prob matrix,
otherwise a tp x unit x prob array.
The confint-method is a convenient wrapper with probs set
according to the required confidence level.

The function scores computes the scoring rules specified in the
argument which.
If multiple units are selected and individual=TRUE, the
result is an array of dimensions
c(nrow(pred),length(units),5+sign) (up to surveillance
1.8-0, the first two dimensions were collapsed to give a matrix).
Otherwise, the result is a matrix with nrow(pred) rows and
5+sign columns. If there is only one predicted time point, the
first dimension is dropped in both cases.


The <a href="calibrationTest.html">calibrationTest</a>- and <a href="pit.html">pit</a>-methods are
just convenient wrappers around the respective default methods.

    <h2 class="hasAnchor" id="references">
<a class="anchor" href="#references"></a>References</h2>

    <p>Czado, C., Gneiting, T. and Held, L. (2009):
    Predictive model assessment for count data.
    <em>Biometrics</em>, <b>65</b> (4), 1254-1261.
    doi: <a href="https://doi.org/10.1111/j.1541-0420.2009.01191.x">10.1111/j.1541-0420.2009.01191.x</a></p>
<p>Paul, M. and Held, L. (2011):
    Predictive assessment of a non-linear random effects model for
    multivariate time series of infectious disease counts.
    <em>Statistics in Medicine</em>, <b>30</b> (10), 1118-1136.
    doi: <a href="https://doi.org/10.1002/sim.4177">10.1002/sim.4177</a></p>
    <h2 class="hasAnchor" id="author">
<a class="anchor" href="#author"></a>Author</h2>

    <p>Sebastian Meyer and Michaela Paul</p>
    <h2 class="hasAnchor" id="see-also">
<a class="anchor" href="#see-also"></a>See also</h2>

    <div class="dont-index"><p><code>vignette("hhh4")</code> and <code>vignette("hhh4_spacetime")</code></p></div>

    <h2 class="hasAnchor" id="examples">
<a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><code class="sourceCode R"><span class="co">### univariate salmonella agona count time series</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"salmonella.agona"</span><span class="op">)</span>
<span class="co">## convert from old "disProg" to new "sts" class</span>
<span class="va">salmonella</span> <span class="op">&lt;-</span> <span class="fu"><a href="disProg2sts.html">disProg2sts</a></span><span class="op">(</span><span class="va">salmonella.agona</span><span class="op">)</span>

<span class="co">## generate formula for temporal and seasonal trends</span>
<span class="va">f.end</span> <span class="op">&lt;-</span> <span class="fu"><a href="addSeason2formula.html">addSeason2formula</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span> <span class="op">+</span> <span class="va">t</span>, S<span class="op">=</span><span class="fl">1</span>, period<span class="op">=</span><span class="fl">52</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>f <span class="op">=</span> <span class="op">~</span><span class="fl">1</span><span class="op">)</span>, end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">f.end</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"NegBin1"</span><span class="op">)</span>
<span class="co">## fit the model</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="hhh4.html">hhh4</a></span><span class="op">(</span><span class="va">salmonella</span>, <span class="va">model</span><span class="op">)</span>

<span class="co">## do sequential one-step-ahead predictions for the last 5 weeks</span>
<span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu">oneStepAhead</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="fl">5</span>, type<span class="op">=</span><span class="st">"rolling"</span>,
                     which.start<span class="op">=</span><span class="st">"final"</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">pred</span>
<span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span>

<span class="co">## simple plot of the 80% one-week-ahead prediction interval</span>
<span class="co">## and point forecasts</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"fanplot"</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pred</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.1</span>,<span class="fl">.9</span><span class="op">)</span>, means.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># \dontshow{</span>
<span class="co">## test equivalence of parallelized version</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"unix"</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">pred</span>,
        <span class="fu">oneStepAhead</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="fl">5</span>, type<span class="op">=</span><span class="st">"rolling"</span>,
                     which.start<span class="op">=</span><span class="st">"final"</span>, verbose<span class="op">=</span><span class="cn">FALSE</span>, cores<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># }</span>

<span class="co">## note: oneStepAhead(..., type="final") just means fitted values</span>
<span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="fu">oneStepAhead</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="fl">5</span>,
                        type<span class="op">=</span><span class="st">"final"</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>


<span class="co">## compute scores of the one-step-ahead predictions</span>
<span class="op">(</span><span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span>

<span class="co">## the above uses the scores-method for "oneStepAhead" predictions,</span>
<span class="co">## which is a simple wrapper around the default method:</span>
<span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">observed</span>, mu <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">pred</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">psi</span><span class="op">)</span><span class="op">)</span>

<span class="co">## scores with respect to the fitted values are similar</span>
<span class="op">(</span><span class="va">scFitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span><span class="va">result</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># \dontshow{</span>
<span class="co">## test that scFitted is equivalent to scores(oneStepAhead(..., type = "final"))</span>
<span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span><span class="op">(</span>
    <span class="va">scFitted</span>,
    <span class="fu"><a href="scores.html">scores</a></span><span class="op">(</span><span class="fu">oneStepAhead</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="fl">5</span>, type<span class="op">=</span><span class="st">"final"</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,
    check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co"># }</span>


<span class="co">## test if the one-step-ahead predictions are calibrated</span>
<span class="fu"><a href="calibrationTest.html">calibrationTest</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span>  <span class="co"># p = 0.8746</span>

<span class="co">## the above uses the calibrationTest-method for "oneStepAhead" predictions,</span>
<span class="co">## which is a simple wrapper around the default method:</span>
<span class="fu"><a href="calibrationTest.html">calibrationTest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">observed</span>, mu <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">pred</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">psi</span><span class="op">)</span><span class="op">)</span>

<span class="co">## we can also test calibration of the fitted values</span>
<span class="co">## using the calibrationTest-method for "hhh4" fits</span>
<span class="fu"><a href="calibrationTest.html">calibrationTest</a></span><span class="op">(</span><span class="va">result</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">salmonella</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>


<span class="co">## plot a (non-randomized) PIT histogram for the predictions</span>
<span class="fu"><a href="pit.html">pit</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span>

<span class="co">## the above uses the pit-method for "oneStepAhead" predictions,</span>
<span class="co">## which is a simple wrapper around the default method:</span>
<span class="fu"><a href="pit.html">pit</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">observed</span>, pdistr <span class="op">=</span> <span class="st">"pnbinom"</span>, mu <span class="op">=</span> <span class="va">pred</span><span class="op">$</span><span class="va">pred</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">psi</span><span class="op">)</span><span class="op">)</span>


<span class="co">### multivariate measles count time series</span>
<span class="co">## (omitting oneStepAhead forecasts here to keep runtime low)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"measlesWeserEms"</span><span class="op">)</span>

<span class="co">## simple hhh4 model with random effects in the endemic component</span>
<span class="va">measlesModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>f <span class="op">=</span> <span class="fu"><a href="addSeason2formula.html">addSeason2formula</a></span><span class="op">(</span><span class="op">~</span><span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="hhh4_formula.html">ri</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"iid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
    ar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>f <span class="op">=</span> <span class="op">~</span><span class="fl">1</span><span class="op">)</span>,
    family <span class="op">=</span> <span class="st">"NegBin1"</span><span class="op">)</span>
<span class="va">measlesFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="hhh4.html">hhh4</a></span><span class="op">(</span><span class="va">measlesWeserEms</span>, control <span class="op">=</span> <span class="va">measlesModel</span><span class="op">)</span>

<span class="co">## assess overall (in-sample) calibration of the model, i.e.,</span>
<span class="co">## if the observed counts are from the fitted NegBin distribution</span>
<span class="fu"><a href="calibrationTest.html">calibrationTest</a></span><span class="op">(</span><span class="va">measlesFit</span><span class="op">)</span> <span class="co"># default is DSS (not suitable for low counts)</span>
<span class="fu"><a href="calibrationTest.html">calibrationTest</a></span><span class="op">(</span><span class="va">measlesFit</span>, which <span class="op">=</span> <span class="st">"rps"</span><span class="op">)</span>  <span class="co"># p = 0.9322</span>
<span class="fu"><a href="calibrationTest.html">calibrationTest</a></span><span class="op">(</span><span class="va">measlesFit</span>, which <span class="op">=</span> <span class="st">"logs"</span><span class="op">)</span> <span class="co"># p = 0.7238</span>

<span class="co">## to assess calibration in the second year for a specific district</span>
<span class="fu"><a href="calibrationTest.html">calibrationTest</a></span><span class="op">(</span><span class="va">measlesFit</span>, subset <span class="op">=</span> <span class="fl">53</span><span class="op">:</span><span class="fl">104</span>, units <span class="op">=</span> <span class="st">"03452"</span>, which <span class="op">=</span> <span class="st">"rps"</span><span class="op">)</span>
<span class="fu"><a href="pit.html">pit</a></span><span class="op">(</span><span class="va">measlesFit</span>, subset <span class="op">=</span> <span class="fl">53</span><span class="op">:</span><span class="fl">104</span>, units <span class="op">=</span> <span class="st">"03452"</span><span class="op">)</span>


<span class="co">### For a more sophisticated multivariate analysis of</span>
<span class="co">### areal time series of influenza counts - data("fluBYBW") -</span>
<span class="co">### see the (computer-intensive) demo("fluBYBW") script:</span>
<span class="va">demoscript</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"demo"</span>, <span class="st">"fluBYBW.R"</span><span class="op">)</span>,
                          package <span class="op">=</span> <span class="st">"surveillance"</span><span class="op">)</span>
<span class="va">demoscript</span>
<span class="co">#file.show(demoscript)</span>
</code></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="sticky-top">
    <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>

    </nav>
</div>
  </div>
</div>


      <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Maintained by <a href="http://www.imbe.med.uni-erlangen.de/cms/sebastian_meyer.html" class="external-link">Sebastian Meyer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

