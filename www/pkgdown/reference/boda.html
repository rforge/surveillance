<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Bayesian Outbreak Detection Algorithm (BODA) — boda • surveillance</title>
<script src="../deps/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="../deps/bs3compat-0.2.4/tabs.js"></script><script src="../deps/bs3compat-0.2.4/bs3compat.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css">
<script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<link href="../syntax-highlighting.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian Outbreak Detection Algorithm (BODA) — boda">
<meta property="og:description" content="The function takes range values of a univariate surveillance time
  series sts and for each time point uses a negative binomial
  regression model to compute the predictive posterior distribution for
  the current observation. The
  \((1-\alpha)\cdot 100\%\)
  quantile of this predictive distribution is then
  used as bound: If the actual observation is above the bound an alarm
  is raised. 
  The Bayesian Outbreak Detection Algorithm (boda) is due to
  Manitz and Höhle (2013) and its implementation is
  illustrated in Salmon et al. (2016).
  However, boda should be considered as an experiment, see the
  Warning section below!">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@bastistician">
<meta name="twitter:site" content="@bastistician">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc" data-headroom data-tolerance="5" data-offset="100">
    

      <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a class="navbar-brand mb-0 h1" href="../index.html">surveillance</a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <button type="button" id="version-badge" class="badge badge-default d-none d-lg-block" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Released version">1.19.1</button>

    <div id="navbar" class="collapse navbar-collapse">
      <ul class="navbar-nav mr-auto ml-3">
<li class="nav-item">
  <a class="nav-link" href="../articles/pkgdown/overview.html">Overview</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/pkgdown/events.html">Events</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/pkgdown/bibliography.html">Bibliography</a>
</li>
      </ul>
<ul class="navbar-nav ml-1"></ul>
</div>
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header pb-2 mt-4 mb-2 border-bottom toc-ignore">
    <h1 class="display-4">Bayesian Outbreak Detection Algorithm (BODA)</h1>
    
    <div class="d-none name"><code>boda.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function takes <code>range</code> values of a univariate surveillance time
  series <code>sts</code> and for each time point uses a negative binomial
  regression model to compute the predictive posterior distribution for
  the current observation. The
  \((1-\alpha)\cdot 100\%\)
  quantile of this predictive distribution is then
  used as bound: If the actual observation is above the bound an alarm
  is raised. 
  The Bayesian Outbreak Detection Algorithm (<code>boda</code>) is due to
  Manitz and Höhle (2013) and its implementation is
  illustrated in Salmon et al. (2016).
  However, <code>boda</code> should be considered as an experiment, see the
  Warning section below!</p>
    </div>

    <pre class="usage"><code class="sourceCode R"><span class="fu">boda</span><span class="op">(</span><span class="va">sts</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    range<span class="op">=</span><span class="cn">NULL</span>, X<span class="op">=</span><span class="cn">NULL</span>, trend<span class="op">=</span><span class="cn">FALSE</span>, season<span class="op">=</span><span class="cn">FALSE</span>,
    prior<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'iid'</span>,<span class="st">'rw1'</span>,<span class="st">'rw2'</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.05</span>, mc.munu<span class="op">=</span><span class="fl">100</span>, 
    mc.y<span class="op">=</span><span class="fl">10</span>, verbose<span class="op">=</span><span class="cn">FALSE</span>,multicore<span class="op">=</span><span class="cn">TRUE</span>,
    samplingMethod<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'joint'</span>,<span class="st">'marginals'</span><span class="op">)</span>,
    quantileMethod<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MC"</span>,<span class="st">"MM"</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span></code></pre>

    <h2>Arguments</h2>
    <dl class="row" id="ref-arguments">
<dt class="col-sm-3" id="ref-arguments name">sts</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>object of class sts (including the <code>observed</code> and the
    <code>state</code> time series)</p></dd>
    <dt class="col-sm-3" id="ref-arguments name">control</dt>
      <dd class="col-sm-9" id="ref-arguments desc">
<p>Control object given as a <code>list</code> containing the following components:</p>
<dl>
<dt><code>range</code></dt>
<dd><p>Specifies the index of all timepoints which
	should be tested. If range is <code>NULL</code> all possible
	timepoints are used.</p></dd> 
      <dt><code>X</code></dt>
<dd><p></p></dd>
      <dt><code>trend</code></dt>
<dd><p>Boolean indicating whether a linear trend term should be
	included in the model for the expectation the log-scale</p></dd>
      <dt><code>season</code></dt>
<dd><p>Boolean to indicate whether a cyclic spline
	should be included.</p></dd>
      <dt><code>alpha</code></dt>
<dd><p>The threshold for declaring an observed count as
	an aberration is the \((1-\alpha)\cdot 100\%\)
	quantile of the predictive posterior.</p></dd>
      <dt><code>mc.munu</code></dt>
<dd><p></p></dd>
      <dt><code>mc.y</code></dt>
<dd><p>Number of samples of \(y\) to generate for
	each par of the mean and size parameter. A total of \(mc.munu
	  \times mc.y\) samples are generated.</p></dd>
      <dt><code>verbose</code></dt>
<dd><p>Argument sent to the inla call. When using ESS
	it might be necessary to force verbose mode for INLA to work.</p></dd>
      <dt><code>multicore</code></dt>
<dd><p>Detect using <code><a href="https://rdrr.io/r/parallel/detectCores.html">parallel::detectCores</a></code>
	how many logical cores are available and set INLA to use this number.</p></dd>
      <dt><code>samplingMethod</code></dt>
<dd><p>Should one sample from the parameters joint distribution (joint) or from their respective marginal posterior distribution (marginals)?</p></dd>
      <dt>quantileMethod</dt>
<dd><p>Character, either <code>MC</code> or <code>MM</code>. Indicates how to compute the quantile based on the posterior distribution (no matter the inference method): either by sampling <code>mc.munu</code> values from the posterior distribution of the parameters and then for each sampled parameters vector sampling <code>mc.y</code> response values so that one gets a vector of response values based on which one computes an empirical quantile (MC method, as explained in Manitz and Höhle 2013); or by sampling <code>mc.munu</code> from the posterior distribution of the parameters and then compute the quantile of the mixture distribution using bisectioning, which is faster.</p></dd>
    
</dl>
<p></p>
</dd>
    </dl>
<h2 class="hasAnchor" id="note">
<a class="anchor" href="#note"></a>Note</h2>

    <p>This function requires the <span style="R">R</span> package <span class="pkg">INLA</span>, which is currently
  <em>not</em> available from CRAN. It can be obtained from INLA's own
  repository via
  <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("INLA", repos="https://inla.r-inla-download.org/R/stable")</a></code>.</p>
    <h2 class="hasAnchor" id="warning">
<a class="anchor" href="#warning"></a>Warning</h2>

    <p>This function is currently experimental!! It also heavily
  depends on the <span class="pkg">INLA</span> package so changes there might affect the
  operational ability of this function. Since the computations
  for the Bayesian GAM are quite involved do not expect this function
  to be particularly fast. Future work could focus on improving the
  speed, e.g., one issue would be to make the inference work in a sequential
  fashion.</p>
    <h2 class="hasAnchor" id="author">
<a class="anchor" href="#author"></a>Author</h2>

    <p>J. Manitz, M. Höhle, M. Salmon</p>
    <h2 class="hasAnchor" id="references">
<a class="anchor" href="#references"></a>References</h2>

    <p>Manitz, J. and Höhle, M. (2013):
  Bayesian outbreak detection algorithm for monitoring reported cases of
  campylobacteriosis in Germany.
  Biometrical Journal, 55(4), 509-526.</p>
<p>Salmon, M., Schumacher, D. and Höhle, M. (2016):
  Monitoring count time series in <span style="R">R</span>: Aberration detection in public
  health surveillance. <em>Journal of Statistical Software</em>,
  <b>70</b> (10), 1-35. doi: <a href="https://doi.org/10.18637/jss.v070.i10">10.18637/jss.v070.i10</a></p>

    <h2 class="hasAnchor" id="examples">
<a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
  <span class="co">## running this example takes a couple of minutes</span>

  <span class="co">#Load the campylobacteriosis data for Germany</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"campyDE"</span><span class="op">)</span>
  <span class="co">#Make an sts object from the data.frame</span>
  <span class="va">cam.sts</span> <span class="op">&lt;-</span>  <span class="fu"><a href="sts-class.html">sts</a></span><span class="op">(</span>epoch<span class="op">=</span><span class="va">campyDE</span><span class="op">$</span><span class="va">date</span>,
                  observed<span class="op">=</span><span class="va">campyDE</span><span class="op">$</span><span class="va">case</span>, state<span class="op">=</span><span class="va">campyDE</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>

  <span class="co">#Define monitoring period</span>
<span class="co">#  range &lt;- which(epoch(cam.sts)&gt;=as.Date("2007-01-01"))</span>
<span class="co">#  range &lt;- which(epoch(cam.sts)&gt;=as.Date("2011-12-10"))</span>
  <span class="va">range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">cam.sts</span><span class="op">)</span>,n<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

  <span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>range<span class="op">=</span><span class="va">range</span>, X<span class="op">=</span><span class="cn">NULL</span>, trend<span class="op">=</span><span class="cn">TRUE</span>, season<span class="op">=</span><span class="cn">TRUE</span>,
                  prior<span class="op">=</span><span class="st">'iid'</span>, alpha<span class="op">=</span><span class="fl">0.025</span>, mc.munu<span class="op">=</span><span class="fl">100</span>, mc.y<span class="op">=</span><span class="fl">10</span>,
                  samplingMethod <span class="op">=</span> <span class="st">"joint"</span><span class="op">)</span>

  <span class="co">#Apply the boda algorithm in its simples form, i.e. spline is</span>
  <span class="co">#described by iid random effects and no extra covariates</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"INLA"</span><span class="op">)</span>  <span class="co"># needs to be attached</span>
  <span class="va">cam.boda1</span> <span class="op">&lt;-</span> <span class="fu">boda</span><span class="op">(</span><span class="va">cam.sts</span>, control<span class="op">=</span><span class="va">control</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cam.boda1</span>, xlab<span class="op">=</span><span class="st">'time [weeks]'</span>, ylab<span class="op">=</span><span class="st">'No. reported'</span>, dx.upperbound<span class="op">=</span><span class="fl">0</span><span class="op">)</span>
<span class="op">}</span>
</code></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="sticky-top">
    <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>

    </nav>
</div>
  </div>
</div>


      <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Maintained by <a href="http://www.imbe.med.uni-erlangen.de/cms/sebastian_meyer.html" class="external-link">Sebastian Meyer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

