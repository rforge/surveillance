
R version 4.0.3 (2020-10-10) -- "Bunny-Wunnies Freak Out"
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ################################################################################
> ### Demo of hhh4() modelling of influenza in Southern Germany - data("fluBYBW")
> ### based on
> ###
> ### Paul, M. and Held, L. (2011): Predictive assessment of a non-linear random
> ### effects model for multivariate time series of infectious disease counts.
> ### Statistics in Medicine, 30, 1118-1136.
> ###
> ### RUNNING THE WHOLE SCRIPT TAKES ~20 MINUTES!
> ###
> ### Copyright (C) 2009-2012 Michaela Paul, 2012-2013,2016-2019 Sebastian Meyer
> ###
> ### This file is part of the R package "surveillance",
> ### free software under the terms of the GNU General Public License, version 2,
> ### a copy of which is available at http://www.r-project.org/Licenses/.
> ################################################################################
> 
> set.seed(1)  # for reproducibility (affects initial values for ri() terms)
> library("surveillance")
Loading required package: sp
Loading required package: xtable
This is surveillance 1.19.0. For overview type â€˜help(surveillance)â€™.
> 
> ## Weekly counts of influenza in 140 districts of Bavaria and Baden-Wuerttemberg
> data("fluBYBW")  # data corrected in surveillance 1.6-0
>                  # -> minor differences to original results in the paper
> 
> 
> ##################################################
> # Fit the models from the Paul & Held (2011) paper
> ##################################################
> 
> ## generate formula for temporal and seasonal trends
> f.end <- addSeason2formula(f = ~ -1 + ri(type="iid", corr="all") +
+                                I((t-208)/100), S=3, period=52)
> 
> ## settings for the optimizer
> opt <- list(stop = list(tol=1e-5, niter=200),
+             regression = list(method="nlminb"),
+             variance = list(method="nlminb"))
> 
> ## models
> # A0
> cntrl_A0 <- list(ar = list(f = ~ -1),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose = 1)
> summary(res_A0 <- hhh4(fluBYBW,cntrl_A0))
2021-01-26 20:09:30 : Iterative optimization of regression & variance parameters 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.398065 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.5920769 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.1475433 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.3389366 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.03550525 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.09774634 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.006808214 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01976921 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001243691 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.003650261 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0002251024 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0006620054 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.072333e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001197866 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.358024e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.164732e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.329361e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.91111e-06 

2021-01-26 20:09:37 : Optimization converged 


Call: 
hhh4(stsObj = fluBYBW, control = cntrl_A0)

Random effects:
            Var    Corr
end.ri(iid) 0.7887     

Fixed effects:
                        Estimate  Std. Error
end.I((t - 208)/100)     0.67437   0.01387  
end.sin(2 * pi * t/52)   2.80355   0.09834  
end.cos(2 * pi * t/52)   2.71166   0.11174  
end.sin(4 * pi * t/52)   0.59112   0.09463  
end.cos(4 * pi * t/52)  -0.47517   0.08420  
end.sin(6 * pi * t/52)   0.03175   0.04938  
end.cos(6 * pi * t/52)  -0.41757   0.04974  
end.ri(iid)              0.52081   0.10872  
overdisp                 2.05226   0.05189  

Penalized log-likelihood:  -20142.55 
Marginal log-likelihood:   -314.21 

Number of units:        140 
Number of time points:  415 

> 
> # B0
> cntrl_B0 <- list(ar = list(f = ~ 1),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_B0 <- hhh4(fluBYBW,cntrl_B0)
2021-01-26 20:09:38 : Iterative optimization of regression & variance parameters 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.23659 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.1947993 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.04703696 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.07091825 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.01405694 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.02084078 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.003858461 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.005694104 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001033708 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001523599 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0002750735 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0004053468 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.313853e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001077084 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.941778e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.860836e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 5.156372e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 7.596714e-06 

2021-01-26 20:09:47 : Optimization converged 

> 
> # C0
> cntrl_C0 <- list(ar = list(f = ~ -1 + ri(type="iid", corr="all")),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_C0 <- hhh4(fluBYBW,cntrl_C0)
2021-01-26 20:09:47 : Iterative optimization of regression & variance parameters 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.231761 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.5633588 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.1006343 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.2153399 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.04943644 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.1185269 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.02898444 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.07542996 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0186313 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.05192439 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.01273769 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.03753407 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.009096619 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0280409 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.006707637 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.02144447 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.005066727 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01668429 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.003898742 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01315023 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.003043582 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01046874 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.002403183 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.008399231 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00191479 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.006780441 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001536773 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.005500568 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001240632 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.004479904 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001015896 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.003660268 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0008347113 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.002998332 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0006876331 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.002461284 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.000567655 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.002023913 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0004693937 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001666615 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0003886582 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001373987 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0003221817 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001133824 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0002672352 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0009363741 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0002218192 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0007738107 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001842438 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0006398143 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001530853 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0005292565 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001272187 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0004379629 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001057517 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0003625272 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 8.791738e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0003001601 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.310213e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0002486166 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.079611e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0002058824 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 5.054116e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001705532 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.202604e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.000141317 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.49474e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001170789 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.905318e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 9.701736e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.415496e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.039884e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.008123e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.663075e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.669333e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 5.5223e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.387592e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 4.577014e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.153308e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.793662e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.585022e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.144533e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.965539e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.606456e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.618897e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.160496e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 5.499464e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.790869e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.568986e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.484485e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.79559e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.23056e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.152943e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.020066e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.618865e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.455856e-06 

2021-01-26 20:10:52 : Optimization converged 

> 
> 
> #A1
> 
> # weight matrix w_ji = 1/(No. neighbors of j) if j ~ i, and 0 otherwise
> wji <- neighbourhood(fluBYBW)/rowSums(neighbourhood(fluBYBW))
> 
> cntrl_A1 <- list(ar = list(f = ~ -1),
+                  ne = list(f = ~ 1, weights = wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_A1 <- hhh4(fluBYBW,cntrl_A1)
2021-01-26 20:10:53 : Iterative optimization of regression & variance parameters 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.298182 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.7436168 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.1963278 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.053119 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.07309795 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.087201 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.02258807 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.2500218 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.006447311 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.05732085 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001837287 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01546722 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0005233378 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.004340074 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001490291 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00123064 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.246112e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0003502637 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.209567e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 9.973534e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.445011e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.840253e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.811354e-07 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.088731e-06 

2021-01-26 20:11:04 : Optimization converged 

> 
> # B1
> cntrl_B1 <- list(ar = list(f = ~ 1),
+                  ne = list(f = ~ 1, weights = wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_B1 <- hhh4(fluBYBW,cntrl_B1)
2021-01-26 20:11:04 : Iterative optimization of regression & variance parameters 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.202573 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.3802928 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.09915599 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.2441789 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.04042004 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.1166118 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.01472222 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.04595297 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.005141422 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01655551 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001769121 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.005760821 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0006056377 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001979851 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0002069336 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0006773408 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.07033e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0002315918 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.415112e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 7.90993e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 8.246004e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.701112e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.815559e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 9.222879e-06 

2021-01-26 20:11:16 : Optimization converged 

> 
> # C1
> cntrl_C1 <- list(ar = list(f = ~ -1 + ri(type="iid", corr="all")),
+                  ne = list(f = ~ 1, weights = wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_C1 <- hhh4(fluBYBW,cntrl_C1)
2021-01-26 20:11:17 : Iterative optimization of regression & variance parameters 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.194615 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.4526604 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.10267 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.1760293 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.04549663 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.09706496 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.02653287 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.06179735 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.01710044 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.04234877 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.01165167 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.03031835 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.008246413 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.02234005 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.005996145 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0167976 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.004446978 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01281789 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.003347198 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00988936 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.002574968 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.007693958 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001998676 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.006024468 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001559985 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.004740756 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001222984 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.003745094 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0009621888 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.002967583 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0007591673 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.002357164 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0006003631 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001875892 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0004756651 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001495163 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0003774415 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001193164 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0002998519 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0009531171 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0002385204 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0007619398 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001898299 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0006095215 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001512233 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0004878417 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001205306 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0003906219 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.611702e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0003128881 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.66824e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0002506974 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.120184e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.000200948 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.886878e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00016105 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.901996e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001291335 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.117369e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001035349 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.490507e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.303181e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.994825e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.659999e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.598997e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 5.342143e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.281774e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 4.285462e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.027603e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.438081e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 8.239196e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.758464e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.606714e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.21334e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 5.298148e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.776055e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.249106e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.425246e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.408031e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.14379e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.733631e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 9.17962e-06 

2021-01-26 20:12:12 : Optimization converged 

> 
> 
> #A2
> cntrl_A2 <- list(ar = list(f = ~ -1),
+                  ne = list(f = ~ -1 + ri(type="iid",corr="all"), weights=wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_A2 <- hhh4(fluBYBW,cntrl_A2)
2021-01-26 20:12:13 : Iterative optimization of regression & variance parameters 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.251645 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.8592892 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.279206 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.3492339 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.1061191 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.07041011 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.02829652 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.02013855 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00776441 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.007017747 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.002489058 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00278749 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0009350625 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001190887 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0004178804 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0005698872 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001940126 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0002734868 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.006479e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001297283 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.179861e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.127403e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.940879e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.890485e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.020281e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.363194e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.194977e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.431034e-06 

2021-01-26 20:12:34 : Optimization converged 

> 
> # B2
> cntrl_B2 <- list(ar = list(f = ~ 1),
+                  ne = list(f = ~ -1 + ri(type="iid",corr="all"), weights =wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_B2 <- hhh4(fluBYBW,cntrl_B2)
2021-01-26 20:12:35 : Iterative optimization of regression & variance parameters 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.173903 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.6870453 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.4075901 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.5267889 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.1605653 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.1511661 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.06693784 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.05460696 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.030204 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.02411586 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.01530368 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01248198 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.008330739 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.007166051 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.004713563 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.004357988 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.002719953 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.002729136 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001584639 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001734024 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.000927042 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001109695 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0005429438 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0007127394 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00031789 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0004586437 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001855005 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0002954454 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001109611 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001904258 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.814082e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001227614 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.187388e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 7.914847e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.575255e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 5.103722e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.585178e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.29129e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.765698e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.122579e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.078316e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.368877e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.806486e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.828046e-06 

2021-01-26 20:13:08 : Optimization converged 

> 
> # C2
> cntrl_C2 <- list(ar = list(f = ~ -1 + ri(type="iid", corr="all")),
+                  ne = list(f = ~ -1 + ri(type="iid",corr="all"), weights =wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1,
+                  start=list(fixed=fixef(res_B0),random=c(rep(0,140),
+                          ranef(res_B0)), sd.corr=c(-.5,res_B0$Sigma.orig,0)))
> res_C2 <- hhh4(fluBYBW,cntrl_C2)
2021-01-26 20:13:09 : Iterative optimization of regression & variance parameters 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.8240727 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.6394624 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.4244192 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.2534102 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.2016556 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.09971042 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.07156894 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.05309592 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.03458077 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.03434793 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.02145759 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.02308368 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.01392491 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01591488 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.009371914 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01116792 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.006502327 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.007935727 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.004613823 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.005690591 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.003348551 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.004108331 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.002477514 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.003101076 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001861447 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.002383025 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001415326 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001837043 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001085791 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001419449 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0008384198 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001098598 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0006506306 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0008511913 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0005059231 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0006600275 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0003943614 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0005120269 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0003079984 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0003972587 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0002404436 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0003082376 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001877693 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0002391476 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001466641 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001855038 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001144602 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001438722 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 8.929635e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001115391 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.962505e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.645273e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 5.425146e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.698845e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.224473e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 5.189056e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.287391e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 4.018317e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.556548e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.110805e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.98695e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.407521e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.543366e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.862705e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.198136e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.440786e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.29632e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.114144e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.209353e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.613394e-06 

2021-01-26 20:16:28 : Optimization converged 

> 
> 
> # D
> cntrl_D <- list(ar = list(f = ~ 1),
+                 ne = list(f = ~ -1 + ri(type="iid"), weights = wji),
+                 end = list(f =addSeason2formula(f = ~ -1 + ri(type="car") +
+                                              I((t-208)/100), S=3, period=52),
+                           offset = population(fluBYBW)),
+                 family = "NegBin1", optimizer = opt, verbose=1)
> res_D <- hhh4(fluBYBW,cntrl_D)
2021-01-26 20:16:30 : Iterative optimization of regression & variance parameters 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.161519 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.713547 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.6087181 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.014891 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.1940522 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 32.53326 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.08956588 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.5363131 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.04708263 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.1870251 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.02480168 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.08349934 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.01312519 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.04074869 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.006974719 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.02073415 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.003718208 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01078631 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0019868 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.005682098 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001063407 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.003015534 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.000569804 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001607437 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0003056273 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0008594926 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0001640066 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.000460232 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 8.803781e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0002468074 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.728321e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001324189 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.539436e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 7.108452e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.364106e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.817036e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.328069e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.050042e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.93689e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.101176e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.11511e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 5.915485e-06 

2021-01-26 20:19:36 : Optimization converged 

> 
> 
> ###########################################################
> ## Exemplary summary of model B2
> ## (compare with Paul & Held, 2011, Table III and Figure 5)
> ###########################################################
> 
> summary(res_B2, idx2Exp = 1:2, maxEV = TRUE)

Call: 
hhh4(stsObj = fluBYBW, control = cntrl_B2)

Random effects:
            Var    Corr   
ne.ri(iid)  0.9645        
end.ri(iid) 0.5066 0.5652 

Fixed effects:
                        Estimate  Std. Error
exp(ar.1)                0.40986   0.01507  
exp(ne.ri(iid))          0.21927   0.02269  
end.I((t - 208)/100)     0.57368   0.02366  
end.sin(2 * pi * t/52)   2.17870   0.09808  
end.cos(2 * pi * t/52)   2.33738   0.12134  
end.sin(4 * pi * t/52)   0.45161   0.10427  
end.cos(4 * pi * t/52)  -0.37668   0.09404  
end.sin(6 * pi * t/52)   0.30145   0.06452  
end.cos(6 * pi * t/52)  -0.24798   0.06294  
end.ri(iid)              0.22345   0.10222  
overdisp                 1.08439   0.03392  

Epidemic dominant eigenvalue:  0.71 

Penalized log-likelihood:  -18696.6 
Marginal log-likelihood:   -343.59 

Number of units:        140 
Number of time points:  415 

> ## Note: as of surveillance 1.6-0, results differ slightly from the paper
> ## (see penalized log-likelihood), because a superfluous row of zeros
> ## has been removed from the fluBYBW data
> 
> .idx <- c(113, 111, 46, 77)
> plot(res_B2, units = .idx, names = fluBYBW@map@data[.idx, "name"],
+      legend = 2, legend.args = list(x = "topleft"), legend.observed = TRUE)
> 
> 
> ######################################################################
> # Compare the predictive performance of the models by computing
> # one-step-ahead predictions to be assessed by proper scoring rules
> ######################################################################
> 
> ## do 1-step ahead predictions for the last two years
> 
> tp <- nrow(fluBYBW)-2*52
> 
> ## for this demo: only calculate pseudo-predictions based on the final fit
> ## to avoid the time-consuming sequential refitting at each step.
> TYPE <- "final"
> ## use "rolling" for true one-step-ahead predictions => TAKES ~8 HOURS!
> 
> val_A0 <- oneStepAhead(res_A0, tp=tp, type=TYPE)
> val_B0 <- oneStepAhead(res_B0, tp=tp, type=TYPE)
> val_C0 <- oneStepAhead(res_C0, tp=tp, type=TYPE)
> 
> val_A1 <- oneStepAhead(res_A1, tp=tp, type=TYPE)
> val_B1 <- oneStepAhead(res_B1, tp=tp, type=TYPE)
> val_C1 <- oneStepAhead(res_C1, tp=tp, type=TYPE)
> 
> val_A2 <- oneStepAhead(res_A2, tp=tp, type=TYPE)
> val_B2 <- oneStepAhead(res_B2, tp=tp, type=TYPE)
> val_C2 <- oneStepAhead(res_C2, tp=tp, type=TYPE)
> 
> val_D <- oneStepAhead(res_D, tp=tp, type=TYPE)
> 
> 
> ## compute scores
> 
> vals <- ls(pattern="val_")
> nam <- substring(vals,first=5,last=6)
> 
> whichScores <- c("logs", "rps", "ses")
> scores_i <- vector(mode="list", length=length(vals))
> meanScores <- NULL
> for(i in seq_along(vals)){
+   sc <- scores(get(vals[i]), which=whichScores, individual=TRUE, reverse=TRUE)
+   ## reverse=TRUE => same permutation test results as in surveillance < 1.16.0
+   scores_i[[i]] <- sc
+   meanScores <- rbind(meanScores,colMeans(sc, dims=2))
+ }
> 
> names(scores_i) <- nam
> rownames(meanScores) <- nam
> 
> print(meanScores)
        logs       rps      ses
A0 0.5756264 0.4904382 7.022261
A1 0.5684291 0.4712157 5.838325
A2 0.5597980 0.4500472 5.296134
B0 0.5495340 0.4269467 4.871094
B1 0.5475791 0.4238789 4.805703
B2 0.5430242 0.4165988 4.761748
C0 0.5480362 0.4243345 4.891340
C1 0.5454461 0.4202067 4.823798
C2 0.5403978 0.4122975 4.736826
D  0.5428446 0.4162501 4.762838
> ## Note that the above use of "final" fitted values instead of "rolling"
> ## one-step-ahead predictions leads to different mean scores than reported
> ## in Paul & Held (2011, Table IV).
> 
> 
> ## assess statistical significance of score differences
> 
> compareWithBest <- function(best, whichModels, nPermut=9999, seed=1234){
+   set.seed(seed)
+   pVals <- NULL
+   for(score in seq_along(whichScores)){
+     p <- c()
+     for(model in whichModels){
+       p <- c(p, if(model==best) NA else
+           permutationTest(scores_i[[model]][,,score],scores_i[[best]][,,score],
+                           plot=interactive(),nPermutation=nPermut, verbose=TRUE)$pVal.permut)
+     }
+     pVals <- cbind(pVals,p)
+   }
+   return(pVals)
+ }
> 
> pVals_flu <- compareWithBest(best=9, whichModels=1:10,
+                              nPermut=999, # reduced for this demo
+                              seed=2059710987)
mean difference = 0.03522857 	p(permutation) = 0.001 	p(paired t-test) = 1.775667e-43 
mean difference = 0.02803133 	p(permutation) = 0.001 	p(paired t-test) = 1.382076e-32 
mean difference = 0.01940018 	p(permutation) = 0.001 	p(paired t-test) = 3.24729e-18 
mean difference = 0.009136163 	p(permutation) = 0.001 	p(paired t-test) = 4.852492e-14 
mean difference = 0.007181322 	p(permutation) = 0.001 	p(paired t-test) = 2.237106e-18 
mean difference = 0.002626401 	p(permutation) = 0.001 	p(paired t-test) = 3.338237e-13 
mean difference = 0.007638358 	p(permutation) = 0.001 	p(paired t-test) = 1.762858e-10 
mean difference = 0.00504834 	p(permutation) = 0.001 	p(paired t-test) = 9.044073e-11 
mean difference = 0.002446793 	p(permutation) = 0.001 	p(paired t-test) = 1.9085e-09 
mean difference = 0.07814074 	p(permutation) = 0.001 	p(paired t-test) = 1.001498e-46 
mean difference = 0.05891819 	p(permutation) = 0.001 	p(paired t-test) = 1.142551e-33 
mean difference = 0.03774973 	p(permutation) = 0.001 	p(paired t-test) = 6.542247e-20 
mean difference = 0.0146492 	p(permutation) = 0.001 	p(paired t-test) = 1.525446e-16 
mean difference = 0.01158136 	p(permutation) = 0.001 	p(paired t-test) = 2.498343e-13 
mean difference = 0.00430131 	p(permutation) = 0.001 	p(paired t-test) = 5.932499e-05 
mean difference = 0.01203702 	p(permutation) = 0.001 	p(paired t-test) = 9.183184e-15 
mean difference = 0.007909168 	p(permutation) = 0.001 	p(paired t-test) = 4.85514e-11 
mean difference = 0.00395262 	p(permutation) = 0.001 	p(paired t-test) = 0.0002941262 
mean difference = 2.285434 	p(permutation) = 0.001 	p(paired t-test) = 3.324155e-07 
mean difference = 1.101499 	p(permutation) = 0.001 	p(paired t-test) = 0.0004245881 
mean difference = 0.5593074 	p(permutation) = 0.015 	p(paired t-test) = 0.01400045 
mean difference = 0.134268 	p(permutation) = 0.116 	p(paired t-test) = 0.1184644 
mean difference = 0.0688762 	p(permutation) = 0.401 	p(paired t-test) = 0.4064999 
mean difference = 0.02492128 	p(permutation) = 0.792 	p(paired t-test) = 0.7916294 
mean difference = 0.1545139 	p(permutation) = 0.047 	p(paired t-test) = 0.05396807 
mean difference = 0.08697136 	p(permutation) = 0.162 	p(paired t-test) = 0.1457529 
mean difference = 0.026012 	p(permutation) = 0.801 	p(paired t-test) = 0.7879801 
> rownames(pVals_flu) <- nam
> colnames(pVals_flu) <- whichScores
> 
> print(pVals_flu)
    logs   rps   ses
A0 0.001 0.001 0.001
A1 0.001 0.001 0.001
A2 0.001 0.001 0.015
B0 0.001 0.001 0.116
B1 0.001 0.001 0.401
B2 0.001 0.001 0.792
C0 0.001 0.001 0.047
C1 0.001 0.001 0.162
C2    NA    NA    NA
D  0.001 0.001 0.801
> 
